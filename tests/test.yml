---
- hosts: all
  remote_user: root

  pre_tasks:
    - name: create test users
      become: yes
      user:
        name: '{{ item }}'
        state: present
        home: '/home/{{ item }}'
        createhome: yes
      with_items:
        - test_usr
        - test_usr2
        - test_usr3

    - name: install dependencies (SUSE)
      command: zypper --non-interactive install python-xml
      changed_when: no
      when: "ansible_os_family == 'Suse'"

    - name: import VS Code RPM key (SUSE)
      rpm_key:
        state: present
        key: 'https://packages.microsoft.com/keys/microsoft.asc'
      when: "ansible_os_family == 'Suse'"

    - name: install VS Code repo (SUSE)
      zypper_repository:
        name: Visual Studio Code
        repo: 'https://packages.microsoft.com/yumrepos/vscode'
        state: present
      when: "ansible_os_family == 'Suse'"

    - name: install VS Code (SUSE)
      zypper:
        name: code
        state: present
      when: "ansible_os_family == 'Suse'"

  roles:
    - role: gantsign.visual-studio-code
      when: ansible_pkg_mgr == 'apt'

    - role: ansible-role-visual-studio-code-extensions
      users:
        - username: test_usr
          visual_studio_code_extensions:
            - donjayamanne.python
            - wholroyd.jinja
        - username: test_usr2
          visual_studio_code_extensions: []
        - username: test_usr3
